!to "loader", cbm

TARGET_ADDRESS = $4500
CHAROUT = $FFD2
DEFAULT_DRIVE = 8
SETNAM = $FFBD
SETLFS = $FFBA
OPEN = $FFC0
LOAD = $FFD5
CHAROUT = $FFD2


*=$0801
!byte $0c,$08,$e5,$07,$9e,$20,$32,$30,$36,$32,$00,$00,$00

jmp main

DEVICE_NUM_LOADER
!byte DEFAULT_DRIVE

ALREADY_LOADED
!byte 0

FILE_NAME
!tx "MANDELBR"

ERROR_TXT
!tx "LOAD ERROR"
!byte $0d,$0a

main
    lda ALREADY_LOADED
    bne .startProgram
    lda #8
    ldx #<FILE_NAME
    ldy #>FILE_NAME
    jsr SETNAM

    lda #$01                          ; logical file number 1
    ldx DEVICE_NUM_LOADER
    ldy #$00                          ; secondary address 0 
    jsr SETLFS

    ; set address of receiving buffer
    ldx #<TARGET_ADDRESS
    ldy #>TARGET_ADDRESS
    lda #$00                          ; do load instead of a verify
    jsr LOAD
    bcs .errLoad
.startProgram
    lda #1
    sta ALREADY_LOADED
    jmp TARGET_ADDRESS
.errLoad
    ldy #0
.charLoop
    lda ERROR_TXT,y
    jsr CHAROUT
    iny
    cpy #12
    bne .charLoop
    rts

